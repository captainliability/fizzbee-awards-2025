<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Fizzbee Awards 2025 ‚Äì 8D Fizz</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --orange:#FF8A00; --champagne:#F7E6B5; --green:#2EAD6B; --navy:#0E2A47; --cream:#FFF9EC;
    }
    *{box-sizing:border-box}
    body{margin:0; font-family:Nunito, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial, "Apple Color Emoji","Segoe UI Emoji"; background:var(--cream); color:#203040}
    header{position:relative; overflow:hidden; background:linear-gradient(135deg, var(--champagne), #fff); border-bottom:6px solid var(--orange)}
    .wrap{max-width:1100px; margin:0 auto; padding:20px}
    .brand{display:flex; align-items:center; gap:16px}
    /* Bigger, clearer logo with white badge */
    .brand img.logo{width:110px; height:110px; object-fit:contain; background:#fff; border-radius:999px; padding:10px; border:3px solid #fff; box-shadow:0 8px 22px rgba(0,0,0,.15)}
    h1{margin:0; font-weight:800; letter-spacing:.5px}
    .subtitle{margin-top:4px; color:#30465a}
    .hero{margin-top:14px; border-radius:18px; overflow:hidden; box-shadow:0 8px 28px rgba(0,0,0,.08); border:3px solid #fff}
    .hero img{width:100%; height:auto; display:block}

    .card{background:#fff; border-radius:18px; padding:18px; box-shadow:0 8px 28px rgba(0,0,0,.08); border:1px solid #eee}
    .card + .card{margin-top:18px}

    .pill{display:inline-block; background:var(--navy); color:#fff; padding:6px 12px; border-radius:999px; font-size:.9rem}

    table{border-collapse:separate; border-spacing:0; width:100%; margin-top:10px; background:#fff; border-radius:16px; overflow:hidden;}
    thead th{position:sticky; top:0; background:#0f2f52; color:#fff; font-weight:700; z-index:2}
    th, td{padding:10px 8px; text-align:center; border-bottom:1px solid #f0f2f5}
    tbody tr:nth-child(odd){background:#fafcff}
    tbody tr:hover{background:#f7fbff}
    th:first-child, td:first-child{position:sticky; left:0; text-align:left; background:inherit; z-index:1}
    th:first-child{background:#0f2f52; color:#fff}
    .cat{font-weight:700}

    .toolbar{display:flex; align-items:center; gap:12px; justify-content:space-between; flex-wrap:wrap}
    button{appearance:none; border:none; background:var(--orange); color:#fff; font-weight:800; padding:12px 18px; border-radius:12px; cursor:pointer; box-shadow:0 6px 18px rgba(255,138,0,.25); transition:.15s transform ease, .15s box-shadow ease}
    button:hover{transform:translateY(-1px); box-shadow:0 8px 22px rgba(255,138,0,.3)}
    button:disabled{opacity:.6; cursor:not-allowed}
    .note{font-size:.92rem; color:#4a5a6a}

    .footer{margin:32px 0 48px; color:#4a5a6a; font-size:.9rem}
    .toast{display:none; margin-top:10px; padding:12px 14px; border-radius:12px; background:#e9f9ef; color:#104226; border:1px solid #c8eed6;}
    .toast.error{background:#fff2f2; color:#611; border-color:#f3cccc}
    .grid{display:grid; gap:18px}
    @media(min-width:900px){.grid{grid-template-columns:2fr 1fr}}
    .cheese{background: linear-gradient(180deg, rgba(255,255,255,.92), rgba(255,255,255,.92)), url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 120"><g fill="%23F9E07F" opacity=".6"><circle cx="20" cy="20" r="6"/><circle cx="80" cy="60" r="8"/><circle cx="140" cy="30" r="5"/><circle cx="180" cy="90" r="7"/></g></svg>'); background-size:cover}
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <div class="brand">
        <img class="logo" src="logo.png" alt="8D Fizz logo" />
        <div>
          <h1>Fizzbee Awards 2025</h1>
          <div class="subtitle">8D Fizz Ultimate ‚Ä¢ Vote once per category ‚Ä¢ Pick yourself first ‚Ä¢ You can skip a category</div>
        </div>
      </div>
      <div class="hero"><img src="team.png" alt="8D Fizz team photo" /></div>
    </div>
  </header>

  <main class="wrap grid">
    <section class="card">
      <div class="toolbar">
        <span class="pill">Voting is open</span>
        <div class="note">Select your name in the first row, then one nominee per category ‚Äî or choose <strong>Skip</strong> in the new column. Hit <strong>Submit</strong> at the bottom.</div>
      </div>

      <div id="toast" class="toast" role="status"></div>

      <div class="table-wrap">
        <table id="voteTable" aria-describedby="Voting table">
          <thead id="thead"></thead>
          <tbody id="tbody"></tbody>
        </table>
      </div>

      <div style="display:flex; gap:12px; align-items:center; justify-content:flex-end; margin-top:14px">
        <button id="submitBtn">Submit votes</button>
        <button id="resetBtn" title="Clear selections">Reset</button>
      </div>
    </section>

    <aside class="card cheese">
      <h3 style="margin-top:0">Rules & Notes</h3>
      <ul>
        <li>One vote per category.</li>
        <li>You must pick your own name in ‚ÄúWho are you?‚Äù</li>
        <li>If you don't want to vote on a category, choose <em>Skip</em>.</li>
        <li>Once you submit, your device remembers your vote (to discourage duplicate entries).</li>
        <li>Results are stored in our private Google Sheet.</li>
      </ul>
      <p class="note">Questions? Ping the captains ü•ÇüßÄü•è</p>
    </aside>
  </main>

  <footer class="wrap footer">¬© 2025 8D Fizz Ultimate Frisbee ‚Ä¢ Fizzbee Awards</footer>

  <script>
    /* --- Configure these two arrays if the roster/categories change --- */
    const TEAM = [
      "Bryan","Christel","David","Dee","Emma","Katharine","Kyla","Philip",
      "Andrea","Cat","Josh","Neil","Rachel","Rick","Scott","Thomas","Victoria","Matt"
    ];

    const CATEGORIES = [
      "Best defensive/offensive player",
      "Best returning player",
      "Most improved player",
      "Best injury",
      "Off-season award",
      "Sportsmanship award",
      "Spirit of the Game award",
      "Honourable mention",
      "Cheese bro of the year",
      "Cider drinker of the year",
      "Best new player",
      "Pull their finger out, and come along more often award",
      "Lifetime achievement award"
    ];

    // üëâ Paste your Apps Script Web App URL here after you deploy it
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbx3GeUFPQ15_UuxUjbV-M9n4HtIza-HMtBqpMF-s6YyIGYdxgyIwqf0eGiiNGfWef_v/exec";
    const SKIP_VALUE = '__SKIP__';
    const SKIP_LABEL = 'Skip';

    /* -------- Build table dynamically -------- */
    const thead = document.getElementById('thead');
    const tbody = document.getElementById('tbody');

    function h(tag, attrs={}, children=[]) {
      const el = document.createElement(tag);
      for (const [k,v] of Object.entries(attrs)) {
        if (k === 'class') el.className = v; else if(k==='html') el.innerHTML=v; else el.setAttribute(k,v);
      }
      children.forEach(c => el.appendChild(typeof c === 'string' ? document.createTextNode(c) : c));
      return el;
    }

    function buildTable(){
      // header row
      const headRow = h('tr');
      headRow.appendChild(h('th', {}, ['Award Category']));
      headRow.appendChild(h('th', {}, [SKIP_LABEL])); // new Skip column
      TEAM.forEach(name => headRow.appendChild(h('th', {}, [name])));
      thead.appendChild(headRow);

      // who are you row
      const who = h('tr');
      who.appendChild(h('th', {scope:'row', class:'cat'}, ['Who are you? (select yourself)']));
      // empty skip cell for this row
      who.appendChild(h('td', {}, ['‚Äî']));
      TEAM.forEach(name => {
        const input = h('input', {type:'radio', name:'voter', value:name, 'aria-label':name});
        who.appendChild(h('td', {}, [input]));
      });
      tbody.appendChild(who);

      // category rows
      CATEGORIES.forEach((cat, i) => {
        const row = h('tr');
        row.appendChild(h('th', {scope:'row', class:'cat'}, [cat]));
        // Skip option as part of the same radio group
        const skipInput = h('input', {type:'radio', name:`cat-${i}`, value:SKIP_VALUE, 'aria-label':`${cat} ‚Üí ${SKIP_LABEL}`});
        row.appendChild(h('td', {}, [skipInput]));
        TEAM.forEach(name => {
          const input = h('input', {type:'radio', name:`cat-${i}`, value:name, 'aria-label':`${cat} ‚Üí ${name}`});
          row.appendChild(h('td', {}, [input]));
        });
        tbody.appendChild(row);
      });
    }

    buildTable();

    /* -------- Utilities -------- */
    const toast = document.getElementById('toast');
    function showToast(msg, isError=false){
      toast.textContent = msg;
      toast.className = 'toast' + (isError ? ' error' : '');
      toast.style.display = 'block';
      setTimeout(()=> toast.style.display='none', 4000);
    }

    function getSelections(){
      const voter = (document.querySelector('input[name="voter"]:checked')||{}).value;
      if(!voter) throw new Error('Please select your name in the first row.');

      // Prevent duplicate submissions by same voter on this device
      const key = `fizzbee2025_voted_${voter}`;
      if(localStorage.getItem(key)){
        throw new Error('Looks like this device has already submitted votes for ' + voter + '.');
      }

      const rows = [];
      CATEGORIES.forEach((cat, i) => {
        const pick = (document.querySelector(`input[name="cat-${i}"]:checked`)||{}).value;
        if(!pick) throw new Error(`Please choose a nominee or Skip for: ${cat}`);
        const nominee = (pick === SKIP_VALUE) ? 'Skip' : pick;
        rows.push({ voter, category: cat, nominee, ts: new Date().toISOString() });
      });
      return {voter, rows};
    }

    async function submitVotes(){
      const btn = document.getElementById('submitBtn');
      btn.disabled = true;
      try{
        const {voter, rows} = getSelections();
        const payload = { action: 'submitVotes', votes: rows };

        if(!/^https?:\/\//.test(SCRIPT_URL)){
          console.warn('SCRIPT_URL not set. Logging payload only.');
          console.log(payload);
          showToast('Demo mode: votes not saved (set your Google Script URL).');
          btn.disabled = false;
          return;
        }

        const res = await fetch(SCRIPT_URL, {
          method: 'POST',
          mode: 'no-cors', // Apps Script supports no-cors for anonymous web apps
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });

        // We can't read the body in no-cors; treat as success
        localStorage.setItem(`fizzbee2025_voted_${voter}`, 'true');
        showToast('Thanks for voting! Your choices have been recorded.');
        document.getElementById('resetBtn').disabled = true;
        btn.disabled = true;

        // disable all inputs
        document.querySelectorAll('input[type="radio"]').forEach(i=> i.disabled = true);
      }catch(err){
        console.error(err);
        showToast(err.message || 'Something went wrong', true);
        btn.disabled = false;
      }
    }

    function resetForm(){
      document.querySelectorAll('input[type="radio"]').forEach(i=> { i.checked=false; i.disabled=false; });
      document.getElementById('submitBtn').disabled = false;
      document.getElementById('resetBtn').disabled = false;
    }

    document.getElementById('submitBtn').addEventListener('click', submitVotes);
    document.getElementById('resetBtn').addEventListener('click', resetForm);
  </script>
</body>
</html>
